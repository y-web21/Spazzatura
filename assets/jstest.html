<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/goodstyle.css">
  <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
  <title>Document</title>
  <style>
		.chkVal{
			height:30vh;
		}

		#imo{
	    margin: 0;
	    width: calc(100% - 0px);
	    font-size: 1rem;
	  }
  </style>
</head>

<body>
	<!-- スクロールバーの長さをグローバル変数として格納 -->
	<script>
		// var windowScrollbarWidth = window.innerWidth - document.body.clientWidth;
	</script>

	<div id="chkVal" calss="chkVal"></div>

	<div id='imo'></div>
  <ul class="float_menu" id="header">
    <li class="d-inline-block"><a href="">menu1</a></li>
    <li class="d-inline-block"><a href="">menu1</a></li>
    <li class="d-inline-block"><a href="">menu2</a></li>
    <li class="d-inline-block"><a href="">menu3</a></li>
    <li class="d-inline-block"><a href="">menu4</a></li>
  </ul>


<div class="circle_nav_position">
	<ul class="circle_menu" id="header">
	  <li class="d-inline-block"><a href="">menu1</a></li>
	  <li class="d-inline-block"><a href="">menu1</a></li>
	  <li class="d-inline-block"><a href="">menu2</a></li>
	  <li class="d-inline-block"><a href="">menu3</a></li>
	  <li class="d-inline-block"><a href="">menu4</a></li>
	</ul>
</div>


  <div class="goto_top_tag">
    <a class="d-block" href="#">Go To Top&ensp;→</a>
  </div>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  <div id="imo">uhohohoh</div>
  <a href="#jumpin">nagareteku,ryuusei</a>

  d<br>
  d<br>

	<p class="kas">hage</p>
	<p class="kas">hage</p>
	<p class="kas">hage</p>
	<p class="kas">hage</p>
	<p class="kas">hage</p>
	<p class="kas">hage</p>
	<p class="kas">hage</p>
	<p class="kas" id="jumpin">hage</p>
	<p class="kas">hage</p>
	<p class="kas">hage</p>
	<p class="kas">hage</p>
	<p class="kas">hage</p>
	<p class="kas">hage</p>
	<p class="kas">hage</p>
	<p class="kas">hage</p>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  <div class="sample"></div>
  <style>
  div.sample{
	float:left;
	width:50px;
	height:40px;
	background:url('./images/favicon.png');
	animation-name: anime;
	animation-duration: 3s;
	animation-timing-function: ease;
	animation-delay:0;
	animation-iteration-count: infinite;
	animation-direction:alternate;
}

@keyframes anime {
	0% {	opacity:1;	}
	100% {	opacity:0;	}
}
</style>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  <a href="#jumpin">nagareteku,ryuusei</a>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
  d<br>
</body>


  <script>
  // global variables
  scrollbarWidth = 0;
  gotoTopHeight = 0
	window.onload = function() {
    gotoTopHeight = parseInt(getCssValue(document.querySelector('.goto_top_tag'),'height'),10);
    // console.log(document.querySelector('.goto_top_tag'));
	};

	// Depends on jQuery
	// DOM load event
	$(document).ready(function(){
	});
	$(window).on('load', function() {
  	// 取得する値が安定しないため、CSSの固定値決め打ちで対応
  	// scrollbarWidth = window.innerWidth - document.body.clientWidth;
  	//  $(".goto_top_tag").css({
  	//  	"left": document.body.clientWidth - gotoTopHeight
  	//  })
	});

	// timer event
	// setInterval(function(){
	// 	console.log('imo')
	// },10);

	// var log = function(){
	// console.log("test");
	// };
	// setTimeout(log, 30000);

	// Scroll event
	var scrollTimer = 0;
  $(window).scroll(function() {
	  let gnavHeight = parseInt($('.float_menu').css('height'), 10);
	  let scrollVolume = $(this).scrollTop();
	  stickyNav(scrollVolume, gnavHeight);

	  //処理負荷軽減
	  clearTimeout(scrollTimer);
  	scrollTimer = setTimeout(function(){
	    console.log('-------')
	    // $('#imo').text($(this).scrollTop());
	    // gotoTop(scrollVolume, 600);

	    chgClassWhenScrolling(scrollVolume,700,'goto_top_tag','sidetab-fadein','sidetab-fadeout');
	    chgClassWhenScrolling(scrollVolume,700,'float_menu','pos-fixed');
	    console.log(scrollTimer + 'ms');
	    console.log(scrollVolume);
    },250);
  });


  // jquery functions
  function stickyNav(scrollVolume, gnavY) {
    if (scrollVolume > gnavY) {
      $("#header").css({
        "top": 0 + "px",
      });
    } else {
      $("#header").css({
        "top": gnavY - scrollVolume + "px",
      });
    }
  }

  function gotoTop(scrollVolume, threshold) {
    if (scrollVolume > threshold) {
      $(".goto_top_tag").css({
      	"display": "block",
      	"left": document.body.clientWidth - gotoTopHeight
      });
    } else {
      $(".goto_top_tag").css({
        "display": "none"
      });
    }
  }

	function chgClassWhenScrolling(scrollVolume,threshold,elementName,addClassName = null,removeClassName = null){
		// 発火回数チェック
		//console.count();
    $('.' + elementName).each(function(){
      if (scrollVolume > threshold){
      	if (addClassName !== null){
          $(this).addClass(addClassName);
      	}
      	if (removeClassName !== null){
          $(this).removeClass(removeClassName);
      	}
      }else{
      	// 初回リロードでクラスが付与され、アニメーションが走るのを防止
        if($(this).hasClass(addClassName)){
	      	if (addClassName !== null){
	          $(this).removeClass(addClassName);
	      	}
	      	if (removeClassName !== null){
	          $(this).addClass(removeClassName);
	      	}
	      }
      }

    });
	}



function chgClassWhenScrolling2(scrollVolume,elementName,addClassName = null,removeClassName = null){
    $('.' + elementName).each(function(){
      let elementTop = $(this).offset().top;
      let windowHeight = $(window).height();
      console.log(scrollVolume);
      console.log(elementTop - windowHeight);

      if (scrollVolume > elementTop - windowHeight){
      	if (addClassName !== null){
          $(this).addClass(addClassName);
      	}
      	if (removeClassName !== null){
          $(this).removeClass(removeClassName);
      	}
      }else{
      	console.log('hage');
      	if (addClassName !== null){
          $(this).removeClass(addClassName);
      	}
      	if (removeClassName !== null){
          $(this).addClass(removeClassName);
      	}
      }

    });
	}

  // common functions
  function getCssValue(element, property) {
  	if (!element || !property) {
   		return null;
  	}
	  let style = window.getComputedStyle(element);
	  let value = style.getPropertyValue(property);
  	return value;
	}
  </script>

</html>